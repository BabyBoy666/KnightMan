!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).rextagtext=e()}(this,function(){"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function t(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function f(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function e(r){var a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}();return function(){var t,e,n,i=u(r);if(a){var s=u(this).constructor;t=Reflect.construct(i,arguments,s)}else t=i.apply(this,arguments);return e=this,!(n=t)||"object"!=typeof n&&"function"!=typeof n?f(e):n}}function r(t,e,n){return(r="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(i){var s=Object.getOwnPropertyDescriptor(i,e);return s.get?s.get.call(n):s.value}})(t,e,n||t)}function a(t){var e=v.create(this),n=e.getContext("2d");t.syncFont(e,n);var i=n.measureText(t.testString);if(i.hasOwnProperty("actualBoundingBoxAscent")&&i.hasOwnProperty("actualBoundingBoxDescent")){var s=i.actualBoundingBoxAscent,r=i.actualBoundingBoxDescent,a={ascent:s,descent:r,fontSize:s+r};return v.remove(e),a}var o=Math.ceil(i.width*t.baselineX),l=o,h=2*l;if(l=l*t.baselineY|0,e.width=o,e.height=h,n.fillStyle="#f00",n.fillRect(0,0,o,h),n.font=t._font,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(t.testString,0,l),a={ascent:0,descent:0,fontSize:0},!n.getImageData(0,0,o,h))return a.ascent=l,a.descent=l+6,a.fontSize=a.ascent+a.descent,v.remove(e),a;var u,c,d=n.getImageData(0,0,o,h).data,f=d.length,y=4*o,p=0,g=!1;for(u=0;u<l;u++){for(c=0;c<y;c+=4)if(255!==d[p+c]){g=!0;break}if(g)break;p+=y}for(a.ascent=l-u,p=f-y,g=!1,u=h;l<u;u--){for(c=0;c<y;c+=4)if(255!==d[p+c]){g=!0;break}if(g)break;p-=y}return a.descent=u-l,a.fontSize=a.ascent+a.descent,v.remove(e),a}function y(t,e,n){if(null==t)return t;switch(o(t)){case"string":return t;case"number":return"#".concat(O(Math.floor(t).toString(16),6,"0",1));case"function":return t(e,n);case"object":return t.hasOwnProperty("r")?t.hasOwnProperty("a")?"rgba(".concat(t.r,",").concat(t.g,",").concat(t.b,",").concat(t.a,")"):"rgb(".concat(t.r,",").concat(t.g,",").concat(t.b,")"):t.hasOwnProperty("h")?t.hasOwnProperty("a")?"hsla(".concat(t.h,",").concat(t.s,",").concat(t.l,",").concat(t.a,")"):"hsl(".concat(t.h,",").concat(t.s,",").concat(t.l,")"):t;default:return t}}function b(t,e,n,i,s,r,a,o,l,h,u,c,d){var f,y,p,g,v,k,x,w,m,S,T,P,b,O,M,C,F;if(f=e,k=d,P=new R(y=n,p=i,g=s,v=r,a),b=P.minWidth,O=P.minHeight,M=b<=g?1:g/b,C=O<=v?1:v/O,F=P.cornerRadius,f.save(),f.beginPath(),f.translate(y,p),S=g-(w=(x=F.br).x*M),T=v-(m=x.y*C),f.moveTo(g,T),0<w&&0<m?X(f,S,T,w,m,B,I,k):(f.lineTo(g,v),f.lineTo(S,v)),S=w=(x=F.bl).x*M,T=v-(m=x.y*C),f.lineTo(w,v),0<w&&0<m?X(f,S,T,w,m,I,H,k):(f.lineTo(0,v),f.lineTo(0,T)),S=w=(x=F.tl).x*M,T=m=x.y*C,f.lineTo(0,T),0<w&&0<m?X(f,S,T,w,m,H,j,k):(f.lineTo(0,0),f.lineTo(S,0)),S=g-(w=(x=F.tr).x*M),T=m=x.y*C,f.lineTo(S,0),0<w&&0<m?X(f,S,T,w,m,j,B,k):(f.lineTo(g,0),f.lineTo(g,T)),f.closePath(),f.restore(),null!=o){var L;if(null!=u)(L=c?e.createLinearGradient(0,0,s,0):e.createLinearGradient(0,0,0,r)).addColorStop(0,o),L.addColorStop(1,u),o=L;e.fillStyle=o,e.fill()}null!=l&&0<h&&(e.strokeStyle=l,e.lineWidth=h,e.stroke())}function T(t,e){var n=Array.isArray(t);if(void 0===e?e=n?[]:{}:function(t){if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]}(e),n){e.length=t.length;for(var i=0,s=t.length;i<s;i++)e[i]=t[i]}else for(var r in t)e[r]=t[r];return e}function l(){}function P(t,e,n,i,s){i<=0&&(n=ot);var r=ut;if(ct.pushMultiple(r),!t||!t.length)return r;for(var a,o,l,h=t.split(ht),u=0,c=h.length;u<c;u++)if(a=h[u],l=u===c-1?st:rt,n!==ot){var d,f;if(o=0===u?i-s:i,a.length<=100)if((w=e(a))<=o){r.push(ct.newline(a,w,l));continue}for(var y,p="",g="",v=0,k=0,x=(d=n===lt?a.split(" "):a).length;k<x;k++)f=d[k],n===lt?(p+=f,k<x-1&&(p+=" ")):p+=f,o<(y=e(p))&&(0===k?r.push(ct.newline("",0,at)):(r.push(ct.newline(g,v,at)),p=f,n===lt&&k<x-1&&(p+=" "),y=e(p)),o=i),g=p,v=y;r.push(ct.newline(g,v,l))}else{var w=e(a);r.push(ct.newline(a,w,l))}return r}var c=Phaser.Renderer.WebGL.Utils,h={renderWebGL:function(t,e,n,i){if(0!==e.width&&0!==e.height){n.addToRenderList(e);var s=e.frame,r=s.width,a=s.height,o=c.getTintAppendFloatAlpha,l=t.pipelines.set(e.pipeline,e),h=l.setTexture2D(s.glTexture,e);t.pipelines.preBatch(e),l.batchTexture(e,s.glTexture,r,a,e.x,e.y,r/e.style.resolution,a/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,r,a,o(e.tintTopLeft,n.alpha*e._alphaTL),o(e.tintTopRight,n.alpha*e._alphaTR),o(e.tintBottomLeft,n.alpha*e._alphaBL),o(e.tintBottomRight,n.alpha*e._alphaBR),e.tintFill,0,0,n,i,!1,h),t.pipelines.postBatch(e)}},renderCanvas:function(t,e,n,i){0!==e.width&&0!==e.height&&(n.addToRenderList(e),t.batchSprite(e,e.frame,n,i))}},v=Phaser.Display.Canvas.CanvasPool,p=0,g=1,k=2,x=0,w=1,m=2,S=/(?:\r\n|\r|\n)/,O=Phaser.Utils.String.Pad,M=Phaser.Utils.Objects.GetAdvancedValue,C=Phaser.Utils.Objects.GetValue,F={backgroundColor:["backgroundColor",null,y],backgroundColor2:["backgroundColor2",null,y],backgroundHorizontalGradient:["backgroundHorizontalGradient",!0,null],backgroundStrokeColor:["backgroundStrokeColor",null,y],backgroundStrokeLineWidth:["backgroundStrokeLineWidth",2,null],backgroundCornerRadius:["backgroundCornerRadius",0,null],backgroundCornerIteration:["backgroundCornerIteration",null,null],fontFamily:["fontFamily","Courier",null],fontSize:["fontSize","16px",null],fontStyle:["fontStyle","",null],color:["color","#fff",y],stroke:["stroke","#fff",y],strokeThickness:["strokeThickness",0,null],shadowOffsetX:["shadow.offsetX",0,null],shadowOffsetY:["shadow.offsetY",0,null],shadowColor:["shadow.color","#000",y],shadowBlur:["shadow.blur",0,null],shadowStroke:["shadow.stroke",!1,null],shadowFill:["shadow.fill",!1,null],underlineColor:["underline.color","#000",y],underlineThickness:["underline.thickness",0,null],underlineOffset:["underline.offset",0,null],halign:["halign","left",null],valign:["valign","top",null],maxLines:["maxLines",0,null],fixedWidth:["fixedWidth",0,null],fixedHeight:["fixedHeight",0,null],resolution:["resolution",0,null],lineSpacing:["lineSpacing",0,null],rtl:["rtl",!1,null],testString:["testString","|MÃ‰qgy",null],baselineX:["baselineX",1.2,null],baselineY:["baselineY",1.4,null],wrapMode:["wrap.mode",0,null],wrapWidth:["wrap.width",0,null]},L=function(){function i(t,e){d(this,i),this.parent=t,this.backgroundColor,this.backgroundColor2,this.backgroundHorizontalGradient,this.backgroundStrokeColor,this.backgroundStrokeLineWidth,this.backgroundCornerRadius,this.backgroundCornerIteration,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.lineSpacing,this.rtl,this.testString,this.baselineX,this.baselineY,this._font,this.setStyle(e,!1,!0);var n=C(e,"metrics",!1);this.metrics=n?{ascent:C(n,"ascent",0),descent:C(n,"descent",0),fontSize:C(n,"fontSize",0)}:a(this)}return s(i,[{key:"canvas",get:function(){return this.parent.canvasText.canvas}},{key:"context",get:function(){return this.parent.canvasText.context}},{key:"isWrapFitMode",get:function(){return 0<this.fixedWidth&&this.wrapMode!==x&&0===this.wrapWidth}},{key:"setStyle",value:function(t,e,n){if(void 0===e&&(e=!0),void 0===n&&(n=!1),t&&t.hasOwnProperty("wrap")){var i=t.wrap;if(i.hasOwnProperty("mode")){var s=i.mode;"string"==typeof s&&(i.mode=W[s])}else i.hasOwnProperty("width")&&(i.mode=1)}for(var r in t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px"),F){var a=F[r],o=a[0],l=n?a[1]:this[r],h=a[2],u=M(t,o,l);h&&(u=h(u)),this[r]=u}var c=C(t,"font",null);this._font=null===c?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:c;var d=C(t,"fill",null);null!==d&&(this.color=y(d));var f=C(t,"images",void 0);return f&&this.parent.addImage(f),e?this.update(!0):this.parent}},{key:"syncFont",value:function(t,e){e.font=this._font}},{key:"syncStyle",value:function(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}},{key:"syncShadow",value:function(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}},{key:"update",value:function(t){return t&&(this._font="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim(),this.metrics=a(this)),this.parent.updateText(t)}},{key:"buildFont",value:function(){var t="".concat(this.fontStyle," ").concat(this.fontSize," ").concat(this.fontFamily).trim();return t!==this._font&&(this._font=t),this}},{key:"setFont",value:function(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=C(t,"fontFamily","Courier"),this.fontSize=C(t,"fontSize","16px"),this.fontStyle=C(t,"fontStyle","")),this.update(!0)}},{key:"setFontFamily",value:function(t){return this.fontFamily=t,this.update(!0)}},{key:"setFontStyle",value:function(t){return this.fontStyle=t,this.update(!0)}},{key:"setFontSize",value:function(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}},{key:"setTestString",value:function(t){return this.testString=t,this.update(!0)}},{key:"setFixedSize",value:function(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(this.isWrapFitMode)}},{key:"setResolution",value:function(t){return this.resolution=t,this.update(!1)}},{key:"setLineSpacing",value:function(t){return this.lineSpacing=t,this.update(!1)}},{key:"setBackgroundColor",value:function(t,e,n){return void 0===n&&(n=!0),this.backgroundColor=y(t,this.canvas,this.context),this.backgroundColor2=y(e,this.canvas,this.context),this.backgroundHorizontalGradient=n,this.update(!1)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.backgroundStrokeColor=y(t,this.canvas,this.context),this.backgroundStrokeLineWidth=e,this.update(!1)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.backgroundCornerRadius=t,this.backgroundCornerIteration=e,this.update(!1)}},{key:"setFill",value:function(t){return this.color=y(t,this.canvas,this.context),this.update(!1)}},{key:"setColor",value:function(t){return this.color=y(t,this.canvas,this.context),this.update(!1)}},{key:"setStroke",value:function(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=y(t,this.canvas,this.context),this.strokeThickness=e),this.update(!0)}},{key:"setShadow",value:function(t,e,n,i,s,r){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n="#000"),void 0===i&&(i=0),void 0===s&&(s=!1),void 0===r&&(r=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=y(n,this.canvas,this.context),this.shadowBlur=i,this.shadowStroke=s,this.shadowFill=r,this.update(!1)}},{key:"setShadowOffset",value:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}},{key:"setShadowColor",value:function(t){return void 0===t&&(t="#000"),this.shadowColor=y(t,this.canvas,this.context),this.update(!1)}},{key:"setShadowBlur",value:function(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}},{key:"setShadowStroke",value:function(t){return this.shadowStroke=t,this.update(!1)}},{key:"setShadowFill",value:function(t){return this.shadowFill=t,this.update(!1)}},{key:"setUnderline",value:function(t,e,n){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===n&&(n=0),this.underlineColor=y(t,this.canvas,this.context),this.underlineThickness=e,this.underlineOffset=n,this.update(!1)}},{key:"setUnderlineColor",value:function(t){return void 0===t&&(t="#000"),this.underlineColor=y(t,this.canvas,this.context),this.update(!1)}},{key:"setUnderlineThickness",value:function(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}},{key:"setUnderlineOffset",value:function(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}},{key:"setWrapMode",value:function(t){return"string"==typeof t&&(t=W[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}},{key:"setWrapWidth",value:function(t){return this.wrapWidth=t,this.update(!1)}},{key:"setAlign",value:function(t,e){return void 0===t&&(t="left"),void 0===e&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}},{key:"setHAlign",value:function(t){return void 0===t&&(t="left"),this.halign=t,this.update(!1)}},{key:"setVAlign",value:function(t){return void 0===t&&(t="top"),this.valign=t,this.update(!1)}},{key:"setMaxLines",value:function(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}},{key:"getTextMetrics",value:function(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}},{key:"setTextMetrics",value:function(t,e){return this.metrics.ascent=t.ascent,this.metrics.descent=t.descent,this.metrics.fontSize=t.fontSize,"string"==typeof e?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=C(e,"fontFamily",this.fontFamily),this.fontSize=C(e,"fontSize",this.fontSize),this.fontStyle=C(e,"fontStyle",this.fontStyle)),this.parent.updateText(!0)}},{key:"lineHeight",get:function(){return this.metrics.fontSize+this.strokeThickness+this.lineSpacing}},{key:"toJSON",value:function(){var t={};for(var e in F)t[e]=this[e];return t.metrics=this.getTextMetrics(),t}},{key:"destroy",value:function(){this.parent=void 0}}]),i}(),W={none:x,word:w,char:m,character:m},z=Phaser.Utils.Objects.GetValue,R=function(){function r(t,e,n,i,s){d(this,r),this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,n,i,s)}return s(r,[{key:"setTo",value:function(t,e,n,i,s){return this.setPosition(t,e),this.setRadius(s),this.setSize(n,i),this}},{key:"setPosition",value:function(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.x=t,this.y=e,this}},{key:"setRadius",value:function(t){var e,n;void 0===t&&(t=0),n="number"==typeof t?e=t:(e=z(t,"x",0),z(t,"y",0));var i=this.cornerRadius;return i.tl=_(z(t,"tl",void 0),e,n),i.tr=_(z(t,"tr",void 0),e,n),i.bl=_(z(t,"bl",void 0),e,n),i.br=_(z(t,"br",void 0),e,n),this}},{key:"setSize",value:function(t,e){return this.width=t,this.height=e,this}},{key:"minWidth",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}},{key:"minHeight",get:function(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}},{key:"width",get:function(){return this._width},set:function(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}},{key:"height",get:function(){return this._height},set:function(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}},{key:"radius",get:function(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)}}]),r}(),_=function(t,e,n){return void 0===t?{x:e,y:n}:"number"==typeof t?{x:t,y:t}:t},A=Phaser.Math.DegToRad,B=A(0),I=A(90),H=A(180),j=A(270),X=function(t,e,n,i,s,r,a,o){if(null==o)t.ellipse(e,n,i,s,0,r,a);else for(var l,h,u,c=(a-r)/(o+=1),d=0;d<=o;d++)u=r+c*d,l=e+i*Math.cos(u),h=n+s*Math.sin(u),t.lineTo(l,h)},Y={draw:function(t,e,n,i){var s=this.penManager;this.hitAreaManager.clear();var r=this.context;r.save();var a=this.defaultStyle;this.clear(),function(t,e,n,i,s,r,a,o){if(null!=e||null!=n){var l=t.canvas.width,h=t.canvas.height;null==n&&(i=0);var u=i/2;l-=i,h-=i,b(t.canvas,t.context,u,u,l,h,s,e,n,i,r,a,o)}}(this,a.backgroundColor,a.backgroundStrokeColor,a.backgroundStrokeLineWidth,a.backgroundCornerRadius,a.backgroundColor2,a.backgroundHorizontalGradient,a.backgroundCornerIteration),t+=this.startXOffset,e+=this.startYOffset;var o,l,h,u,c,d,f=a.halign,y=a.valign,p=a.lineHeight,g=s.lines,v=g.length,k=a.maxLines;u=(h=0<k&&k<v?(l=k,"center"===y?Math.floor((v-l)/2):"bottom"===y?v-l:0):(l=v,0))+l,d="center"===y?Math.max((i-l*p)/2,0):"bottom"===y?Math.max(i-l*p-2,0):0,d+=e;for(var x=h;x<u;x++)if(0!==(o=s.getLineWidth(x))){for(var w=g[x],m=w.length,S=f,T=0;T<m;T++){var P=w[T].prop.align;if(P){S=P;break}}c="center"===S?(n-o)/2:"right"===S?n-o:0,c+=t;for(T=0;T<m;T++)this.drawPen(w[T],c,d)}r.restore()},drawPen:function(t,e,n){e+=t.x,n+=t.y+(t.prop.y||0);var i=this.canvas,s=this.context;s.save();var r=this.parser.propToContextStyle(this.defaultStyle,t.prop);r.buildFont(),r.syncFont(i,s),r.syncStyle(i,s),0<r.underlineThickness&&0<t.width&&this.drawUnderline(e,n,t.width,r),t.isTextPen&&this.drawText(e,n,t.text,r),t.isImagePen&&this.drawImage(e,n,t.prop.img,r),s.restore(),t.hasAreaMarker&&0<t.width&&this.hitAreaManager.add(t.prop.area,e,n-this.startYOffset,t.width,this.defaultStyle.lineHeight)},clear:function(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawUnderline:function(t,e,n,i){e+=i.underlineOffset-i.underlineThickness/2,this.autoRound&&(t=Math.round(t),e=Math.round(e));var s=this.context,r=s.lineCap;s.lineCap="butt",s.strokeStyle=i.underlineColor,s.lineWidth=i.underlineThickness,s.beginPath(),s.moveTo(t,e),s.lineTo(t+n,e),s.stroke(),s.lineCap=r},drawText:function(t,e,n,i){this.autoRound&&(t=Math.round(t),e=Math.round(e));var s=this.context;i.stroke&&"none"!==i.stroke&&0<i.strokeThickness&&(i.syncShadow(s,i.shadowStroke),s.strokeText(n,t,e)),i.color&&"none"!==i.color&&(i.syncShadow(s,i.shadowFill),s.fillText(n,t,e))},drawImage:function(t,e,n){e-=this.startYOffset,this.parent.imageManager.draw(n,this.context,t,e,this.autoRound)}},G=function(){function t(){d(this,t),this.items=[]}return s(t,[{key:"destroy",value:function(){this.clear(),this.items=void 0}},{key:"pop",value:function(){return 0<this.items.length?this.items.pop():null}},{key:"push",value:function(t){return this.items.push(t),this}},{key:"pushMultiple",value:function(t){return this.items.push.apply(this.items,t),t.length=0,this}},{key:"clear",value:function(){return this.items.length=0,this}}]),t}(),D=Phaser.Utils.Objects.GetValue,U=p,V=g,N=function(){function e(t){d(this,e),this.prop={},this.resetFromJSON(t)}return s(e,[{key:"resetFromJSON",value:function(t){this.text=D(t,"text",""),this.x=D(t,"x",0),this.y=D(t,"y",0),this.width=D(t,"width",0);var e=D(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=D(t,"newLineMode",0),this.startIndex=D(t,"startIndex",0)}},{key:"plainText",get:function(){var t=this.text;return this.newLineMode===V&&(t+="\n"),t}},{key:"wrapText",get:function(){var t=this.text;return this.newLineMode!==U&&(t+="\n"),t}},{key:"rawTextLength",get:function(){var t=this.text.length;return this.newLineMode===V&&(t+=1),t}},{key:"endIndex",get:function(){return this.startIndex+this.rawTextLength}},{key:"lastX",get:function(){return this.x+this.width}},{key:"isTextPen",get:function(){return""!==this.text}},{key:"isImagePen",get:function(){return!!this.prop.img}},{key:"hasAreaMarker",get:function(){return!!this.prop.area}}]),e}(),J=Phaser.Utils.Objects.GetFastValue,E=p,q=k,$=new G,K=new G,Q=function(){function o(t){d(this,o),this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.PensPool=J(t,"pensPool",$),this.LinesPool=J(t,"linesPool",K),this.tagToText=J(t,"tagToText",l),this.tagToTextScope=J(t,"tagToTextScope",void 0)}return s(o,[{key:"destroy",value:function(){this.clear(),this.tagToText=void 0,this.tagToTextScope=void 0}},{key:"clear",value:function(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.PensPool.pushMultiple(this.pens),this.LinesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}},{key:"addTextPen",value:function(t,e,n,i,s,r){var a=this.PensPool.pop();return null==a&&(a=new N),Z.text=t,Z.x=e,Z.y=n,Z.width=i,Z.prop=s,Z.newLineMode=r,a.resetFromJSON(Z),this.addPen(a),this}},{key:"addImagePen",value:function(t,e,n,i){return this.addTextPen("",t,e,n,i,E),this}},{key:"addNewLinePen",value:function(){var t=this.lastPen,e=t?t.lastX:0,n=t?t.y:0,i=t?T(t.prop):null;return this.addTextPen("",e,n,0,i,q),this}},{key:"addPen",value:function(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var n=this.lastLine;null==n&&(n=this.LinesPool.pop()||[],this.lines.push(n)),n.push(t),t.newLineMode!==E&&(n=this.LinesPool.pop()||[],this.lines.push(n)),this.maxLinesWidth=void 0}},{key:"clone",value:function(t){null==t&&(t=new o),t.clear();for(var e=0,n=this.lines.length;e<n;e++)for(var i=this.lines[e],s=0,r=i.length;s<r;s++){var a=i[s];t.addPen(a.text,a.x,a.y,a.width,T(a.prop),a.newLineMode)}return t}},{key:"lastPen",get:function(){return this.pens[this.pens.length-1]}},{key:"lastLine",get:function(){return this.lines[this.lines.length-1]}},{key:"getLineStartIndex",value:function(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}},{key:"getLineEndIndex",value:function(t){t>=this.lines.length&&(t=this.lines.length-1);var e,n,i=!1;for(e=t;0<=e&&!(i=null!=(n=this.lines[e])&&0<n.length);e--);return i?n[n.length-1].endIndex:0}},{key:"getLineWidth",value:function(t){var e=this.lines[t];if(!e)return 0;var n=e[e.length-1];return null==n?0:n.lastX}},{key:"getMaxLineWidth",value:function(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,n=0,i=this.lines.length;n<i;n++)e<(t=this.getLineWidth(n))&&(e=t);return this.maxLinesWidth=e}},{key:"getLineWidths",value:function(){for(var t=[],e=0,n=this.lines.length;e<n;e++)t.push(this.getLineWidth(e));return t}},{key:"linesCount",get:function(){return this.lines.length}},{key:"plainText",get:function(){for(var t="",e=this.pens,n=0,i=e.length;n<i;n++)t+=e[n].plainText;return t}},{key:"rawTextLength",get:function(){for(var t=0,e=this.pens,n=0,i=this.pens.length;n<i;n++)t+=e[n].rawTextLength;return t}},{key:"getSliceTagText",value:function(t,e,n){if(void 0===t&&(t=0),void 0===e){var i=this.lastPen;if(null==i)return"";e=i.endIndex}void 0===n&&(n=!1);for(var s,r,a,o,l,h,u="",c=0,d=this.pens.length;c<d&&((o=(s=this.pens[c]).endIndex)<=t||(s=this.pens[c],r=n?s.wrapText:s.plainText,l=s.prop,t<=(a=s.startIndex)&&o<=e||(r=r.substring(t-a,e-a)),this.tagToTextScope?u+=this.tagToText.call(this.tagToTextScope,r,l,h):u+=this.tagToText(r,l,h),h=l,!(e<=o)));c++);return u}},{key:"length",get:function(){return this.lines.length},set:function(){this.clear()}}]),o}(),Z={},tt=Phaser.Geom.Rectangle,et=new G,nt=function(){function t(){d(this,t),this.hitAreas=[]}return s(t,[{key:"destroy",value:function(){this.clear()}},{key:"clear",value:function(){return et.pushMultiple(this.hitAreas),this}},{key:"add",value:function(t,e,n,i,s){var r=et.pop();return null===r?r=new tt(e,n,i,s):r.setTo(e,n,i,s),r.key=t,this.hitAreas.push(r),this}},{key:"getFirstHitArea",value:function(t,e){for(var n,i=this.hitAreas,s=0,r=i.length;s<r;s++)if((n=i[s]).contains(t,e))return n;return null}},{key:"drawBounds",value:function(t,e,n){void 0===e&&(e=16777215),n&&t.save().scaleCanvas(n.scaleX,n.scaleY).rotateCanvas(n.rotation).translateCanvas(n.x,n.y);for(var i,s=this.hitAreas,r=0,a=s.length;r<a;r++)i=s[r],t.lineStyle(1,e).strokeRect(i.x,i.y,i.width,i.height);return n&&t.restore(),this}}]),t}(),it=function(t,e,n,i){var s=this.hitAreaManager.getFirstHitArea(n,i);if(null!==s){var r=s.key;this.parent.emit("".concat(t,"-").concat(r),e,n,i),this.parent.emit(t,r,e,n,i)}},st=p,rt=g,at=k,ot=x,lt=w,ht=S,ut=[],ct=new G;ct.newline=function(t,e,n){var i=this.pop();return null===i&&(i={}),i.text=t,i.width=e,i.newLineMode=n,i};var dt=Phaser.Utils.Objects.GetValue,ft=x,yt=p,pt=function(){function n(t){d(this,n),this.parent=t.parent,this.context=dt(t,"context",null),this.canvas=this.context.canvas,this.parser=dt(t,"parser",null),this.defaultStyle=dt(t,"style",null),this.autoRound=!0,this.pensPool=dt(t,"pensPool",null),this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new nt;var e=this.context;this.getTextWidth=function(t){return e.measureText(t).width}}return s(n,[{key:"destroy",value:function(){this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defaultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0)}},{key:"updatePenManager",value:function(t,e,n,i,s){if(void 0===s&&(s=this.penManager),s.clear(),""===t)return s;if(this.parent.style.isWrapFitMode){var r=this.parent.padding;n=this.parent.style.fixedWidth-r.left-r.right}for(var a,o,l,h,u,c=this.canvas,d=this.context,f=function(t){return d.measureText(t).width},y=0,p=0,g=this.parser.splitText(t),v=0,k=g.length;v<k;v++)if(a=(h=this.parser.tagTextToProp(g[v],o)).plainText,(o=h.prop).img){var x=this.imageManager.getOuterWidth(o.img);0<n&&e!==ft&&n<y+x&&(s.addNewLinePen(),p+=i,y=0),s.addImagePen(y,p,x,T(o)),y+=x}else if(""!==a){var w;d.save(),(l=this.parser.propToContextStyle(this.defaultStyle,o)).buildFont(),l.syncFont(c,d),l.syncStyle(c,d);for(var m=0,S=(u=P(a,f,e,n,y)).length;m<S;m++)w=u[m],s.addTextPen(w.text,y,p,w.width,T(o),w.newLineMode),w.newLineMode!==yt?(y=0,p+=i):y+=w.width;d.restore()}return s}},{key:"startXOffset",get:function(){return this.defaultStyle.strokeThickness/2}},{key:"startYOffset",get:function(){var t=this.defaultStyle;return t.strokeThickness/2+t.metrics.ascent}},{key:"lines",get:function(){return this.penManager.lines}},{key:"desplayLinesCount",get:function(){var t=this.penManager.linesCount,e=this.defaultStyle.maxLines;return 0<e&&e<t&&(t=e),t}},{key:"linesWidth",get:function(){return this.penManager.getMaxLineWidth()}},{key:"linesHeight",get:function(){var t=this.desplayLinesCount,e=this.defaultStyle.lineHeight*t;return 0<t&&(e-=this.defaultStyle.lineSpacing),e}},{key:"imageManager",get:function(){return this.parent.imageManager}},{key:"newPenManager",value:function(){return new Q({pensPool:this.pensPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}},{key:"tmpPenManager",get:function(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}},{key:"getPlainText",value:function(t,e,n){var i;if(null==t)i=this.penManager.plainText;else{var s=this.parser.splitText(t,1);i="";for(var r=0,a=s.length;r<a;r++)i+=s[r]}return null==e&&null==n||(null==e&&(e=0),null==n&&(n=i.length),i=i.substring(e,n)),i}},{key:"getPenManager",value:function(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var n=this.defaultStyle;return this.updatePenManager(t,n.wrapMode,n.wrapWidth,n.lineHeight,e),e}},{key:"getText",value:function(t,e,n,i){if(null==t)return this.penManager.getSliceTagText(e,n,i);var s=this.tmpPenManager,r=this.defaultStyle;return this.updatePenManager(t,r.wrapMode,r.wrapWidth,r.lineHeight,s),s.getSliceTagText(e,n,i)}},{key:"copyPenManager",value:function(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}},{key:"getTextWidth",value:function(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}},{key:"getLastPen",value:function(t){return void 0===t&&(t=this.penManager),t.lastPen}}]),n}(),gt={setInteractive:function(){this.parent.on("pointerdown",function(t,e,n,i){it.call(this,"areadown",t,e,n)},this).on("pointerup",function(t,e,n,i){it.call(this,"areaup",t,e,n)},this)}};Object.assign(pt.prototype,Y,gt);function vt(t,e){void 0===e&&(e={key:t}),e.hasOwnProperty("key")||(e.key=t);var n=e.key,i=e.frame,s=e.width,r=e.height;if(void 0===s||void 0===r){var a=this.textureManager.getFrame(n,i),o=a?a.cutWidth:0,l=a?a.cutHeight:0;void 0===s&&void 0===r?(s=o,r=l):void 0===s?s=o*(r/l):void 0===r&&(r=l*(s/o))}this.images[t]={key:n,frame:i,width:s,height:r,y:kt(e,"y",0),left:kt(e,"left",0),right:kt(e,"right",0)}}var kt=Phaser.Utils.Objects.GetValue,xt=function(){function e(t){d(this,e),this.textureManager=t.textures,this.images={}}return s(e,[{key:"destroy",value:function(){this.textureManager=void 0,this.images=void 0}},{key:"add",value:function(t,e){if("string"==typeof t)vt.call(this,t,e);else if(Array.isArray(t))for(var n=0,i=(s=t).length;n<i;n++)vt.call(this,s[n]);else{var s=t;for(var t in s)vt.call(this,t,s[t])}return this}},{key:"has",value:function(t){return this.images.hasOwnProperty(t)}},{key:"remove",value:function(t){return this.has(t)&&delete this.images[t],this}},{key:"get",value:function(t){return this.has(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}},{key:"getOuterWidth",value:function(t){var e=this.get(t);return e?e.width+e.left+e.right:0}},{key:"getFrame",value:function(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}},{key:"hasTexture",value:function(t){return!!this.getFrame(t)}}]),e}(),wt={draw:function(t,e,n,i,s){var r=this.get(t);n+=r.left,i+=r.y,s&&(n=Math.round(n),i=Math.round(i));var a=this.textureManager.getFrame(r.key,r.frame);e.drawImage(a.source.image,a.cutX,a.cutY,a.cutWidth,a.cutHeight,n,i,r.width,r.height)}};Object.assign(xt.prototype,wt);var mt=Phaser.Utils.Objects.IsPlainObject,St=Phaser.DOM.AddToDOM,Tt=Phaser.Display.Canvas.CanvasPool,Pt=Phaser.GameObjects.GameObject,bt=Phaser.Utils.Objects.GetValue,Ot=Phaser.DOM.RemoveFromDOM,Mt=S,Ct={},Ft=function(){t(c,Pt);var u=e(c);function c(t,e,n,i,s,r,a){var o;if(d(this,c),mt(e)){var l=e;e=bt(l,"x",0),n=bt(l,"y",0),i=bt(l,"text",""),s=bt(l,"style","")}if(void 0===e&&(e=0),void 0===n&&(n=0),(o=u.call(this,t,r)).renderer=t.sys.game.renderer,o.setPosition(e,n),o.setOrigin(0,0),o.initPipeline(),o.canvas=Tt.create(f(o)),o.context=o.canvas.getContext("2d"),o._imageManager=void 0,s){if(s.hasOwnProperty("align")){var h=s.align;delete s.align,s.halign=h}s.hasOwnProperty("stroke")&&!s.hasOwnProperty("strokeThickness")&&(s.strokeThickness=1)}return o.style=new L(f(o),s),o.autoRound=!0,o._text=void 0,o.padding={left:0,right:0,top:0,bottom:0},o.width=1,o.height=1,o.dirty=!1,0===o.style.resolution&&(o.style.resolution=1),o._crop=o.resetCropObject(),o.texture=t.sys.textures.addCanvas(null,o.canvas,!0),o.frame=o.texture.get(),o.frame.source.resolution=o.style.resolution,o.renderer.gl&&(o.renderer.deleteTexture(o.frame.source.glTexture),o.frame.source.glTexture=null),Ct.hasOwnProperty(r)||(Ct[r]=new G),o.canvasText=new pt({parent:f(o),context:o.context,parser:a,style:o.style,pensPool:Ct[r]}),s&&s.padding&&o.setPadding(s.padding),o.setText(i),t.sys.game.events.on("contextrestored",o.onContextRestored,f(o)),o}return s(c,[{key:"onContextRestored",value:function(){this.dirty=!0}},{key:"preDestroy",value:function(){this.style.rtl&&Ot(this.canvas),this.scene.sys.game.events.off("contextrestored",this.onContextRestored,this),Tt.remove(this.canvas),this.canvasText.destroy(),this.canvasText=void 0,this._imageManager&&(this._imageManager.destroy(),this._imageManager=void 0)}},{key:"text",get:function(){return this._text},set:function(t){this.setText(t)}},{key:"initRTL",value:function(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",St(this.canvas,this.scene.sys.canvas),this.originX=1)}},{key:"setText",value:function(t){return null==t&&(t=""),Array.isArray(t)&&(t=t.join("\n")),t!==this._text&&(this._text=t.toString(),this.updateText()),this}},{key:"appendText",value:function(t){return null==t||(Array.isArray(t)&&(t=t.join("\n")),this.setText(this.text+t.toString())),this}},{key:"setStyle",value:function(t){return this.style.setStyle(t)}},{key:"setFont",value:function(t){return this.style.setFont(t)}},{key:"setFontFamily",value:function(t){return this.style.setFontFamily(t)}},{key:"setFontSize",value:function(t){return this.style.setFontSize(t)}},{key:"setFontStyle",value:function(t){return this.style.setFontStyle(t)}},{key:"setFixedSize",value:function(t,e){return this.style.setFixedSize(t,e)}},{key:"setBackgroundColor",value:function(t,e,n){return this.style.setBackgroundColor(t,e,n)}},{key:"setBackgroundStrokeColor",value:function(t,e){return this.style.setBackgroundStrokeColor(t,e)}},{key:"setBackgroundCornerRadius",value:function(t,e){return this.style.setBackgroundCornerRadius(t,e)}},{key:"setFill",value:function(t){return this.style.setFill(t)}},{key:"setColor",value:function(t){return this.style.setColor(t)}},{key:"setStroke",value:function(t,e){return this.style.setStroke(t,e)}},{key:"setShadow",value:function(t,e,n,i,s,r){return this.style.setShadow(t,e,n,i,s,r)}},{key:"setShadowOffset",value:function(t,e){return this.style.setShadowOffset(t,e)}},{key:"setShadowColor",value:function(t){return this.style.setShadowColor(t)}},{key:"setShadowBlur",value:function(t){return this.style.setShadowBlur(t)}},{key:"setShadowStroke",value:function(t){return this.style.setShadowStroke(t)}},{key:"setShadowFill",value:function(t){return this.style.setShadowFill(t)}},{key:"setWrapMode",value:function(t){return this.style.setWrapMode(t)}},{key:"setWrapWidth",value:function(t){return this.style.setWrapWidth(t)}},{key:"setAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setHAlign",value:function(t){return this.style.setHAlign(t)}},{key:"setVAlign",value:function(t){return this.style.setVAlign(t)}},{key:"setLineSpacing",value:function(t){return this.style.setLineSpacing(t)}},{key:"setPadding",value:function(t,e,n,i){if("object"===o(t)){var s=t,r=bt(s,"x",null);n=null!==r?t=r:(t=bt(s,"left",0),bt(s,"right",t));var a=bt(s,"y",null);i=null!==a?e=a:(e=bt(s,"top",0),bt(s,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===n&&(n=t),void 0===i&&(i=e);return this.padding.left=t,this.padding.top=e,this.padding.right=n,this.padding.bottom=i,this.updateText(!1)}},{key:"setMaxLines",value:function(t){return this.style.setMaxLines(t)}},{key:"setResolution",value:function(t){return this.style.setResolution(t)}},{key:"updateText",value:function(t){void 0===t&&(t=!0);var e=this.canvasText,n=this.style;t&&e.updatePenManager(this._text,n.wrapMode,n.wrapWidth,n.lineHeight);var i,s,r=this.padding;0===n.fixedWidth?(this.width=e.linesWidth+r.left+r.right,i=e.linesWidth):(this.width=n.fixedWidth,(i=this.width-r.left-r.right)<e.linesWidth&&(i=e.linesWidth)),0===n.fixedHeight?(this.height=e.linesHeight+r.top+r.bottom,s=e.linesHeight):(this.height=n.fixedHeight,(s=this.height-r.top-r.bottom)<e.linesHeight&&(s=e.linesHeight));var a=this.width,o=this.height;this.updateDisplayOrigin();var l=n.resolution;a*=l,o*=l,a=Math.max(Math.ceil(a),1),o=Math.max(Math.ceil(o),1);var h=this.canvas,u=this.context;h.width!==a||h.height!==o?(h.width=a,h.height=o,this.frame.setSize(a,o)):u.clearRect(0,0,a,o),u.save(),u.scale(l,l),e.draw(r.left,r.top,i,s),u.restore(),this.renderer&&this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(h,this.frame.source.glTexture,!0),this.frame.glTexture=this.frame.source.glTexture),this.dirty=!0;var c=this.input;return c&&!c.customHitArea&&(c.hitArea.width=this.width,c.hitArea.height=this.height),this}},{key:"getTextMetrics",value:function(){return this.style.getTextMetrics()}},{key:"setTextMetrics",value:function(t,e){return this.style.setTextMetrics(t,e)}},{key:"toJSON",value:function(){var t=Lt.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}},{key:"setInteractive",value:function(t,e,n){return Pt.prototype.setInteractive.call(this,t,e,n),this.canvasText.setInteractive(),this}},{key:"getWrappedText",value:function(t,e,n){return(t=this.canvasText.getText(t,e,n,!0)).split(Mt)}},{key:"getPlainText",value:function(t,e,n){return this.canvasText.getPlainText(t,e,n)}},{key:"getText",value:function(t,e,n){return this.canvasText.getText(t,e,n,!1)}},{key:"getSubString",value:function(t,e,n){return this.getText(t,e,n)}},{key:"copyPenManager",value:function(t){return this.canvasText.copyPenManager(t)}},{key:"getPenManager",value:function(t,e){return this.canvasText.getPenManager(t,e)}},{key:"setSize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"resize",value:function(t,e){return this.setFixedSize(t,e)}},{key:"lineSpacing",get:function(){return this.style.lineSpacing},set:function(t){this.setLineSpacing(t)}},{key:"imageManager",get:function(){return this._imageManager||(this._imageManager=new xt(this.scene)),this._imageManager}},{key:"addImage",value:function(t,e){return this.imageManager.add(t,e),this}},{key:"drawAreaBounds",value:function(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}}]),c}(),Lt=Phaser.GameObjects.Components;Phaser.Class.mixin(Ft,[Lt.Alpha,Lt.BlendMode,Lt.ComputedSize,Lt.Crop,Lt.Depth,Lt.Flip,Lt.GetBounds,Lt.Mask,Lt.Origin,Lt.Pipeline,Lt.ScrollFactor,Lt.Tint,Lt.Transform,Lt.Visible,h]);var Wt={plainText:null,prevProp:null},zt=new L,Rt=function(){function e(t){d(this,e),void 0===t&&(t={}),this.tags=t}return s(e,[{key:"addTag",value:function(t,e){this.tags[t]=e}},{key:"splitText",value:function(t,e){for(var n=[],i=0;;){var s=Bt.exec(t);if(!s){var r=t.length;return i<r&&n.push(t.substring(i,r)),n}var a=s[0],o=Bt.lastIndex-a.length;if(i<o&&n.push(t.substring(i,o)),void 0===e)n.push(a);else if(1===e)if(It.test(a)){var l=a.match(Ht);n.push(l[2])}else if(jt.test(a)){l=a.match(Xt);n.push(l[2])}i=Bt.lastIndex}}},{key:"tagTextToProp",value:function(t){var e,n;if(It.test(t)){if(null!=(r=t.match(Ht))){var i=r[1],s=this.tags;(n=s.hasOwnProperty(i)?s[i]:{})._class=i,e=r[2]}}else if(jt.test(t)){var r;if(null!=(r=t.match(Xt))){var a=r[1];(n=_t(a))._style=a,e=r[2]}}null==e&&(e=t),null==n&&(n={});var o=Wt;return o.plainText=e,o.prop=n,o}},{key:"propToContextStyle",value:function(t,e){var n=zt;if(e.hasOwnProperty("img"))n.image=e.img;else{if(n.image=null,e.hasOwnProperty("family")||e.hasOwnProperty("fontFamily")||e.hasOwnProperty("font-family")){var i=e.hasOwnProperty("family")?e.family:e.hasOwnProperty("fontFamily")?e.fontFamily:e["font-family"];n.fontFamily=i}else n.fontFamily=t.fontFamily;if(e.hasOwnProperty("size")||e.hasOwnProperty("fontSize")||e.hasOwnProperty("font-size")){var s=e.hasOwnProperty("size")?e.size:e.hasOwnProperty("fontSize")?e.fontSize:e["font-size"];"number"==typeof s&&(s="".concat(s,"px")),n.fontSize=s}else n.fontSize=t.fontSize;if(e.hasOwnProperty("style")||e.hasOwnProperty("fontStyle")||e.hasOwnProperty("font-style")){var r=e.hasOwnProperty("style")?e.style:e.hasOwnProperty("fontStyle")?e.fontStyle:e["font-style"];n.fontStyle=r}else n.fontStyle=t.fontStyle;if(e.hasOwnProperty("color")||e.hasOwnProperty("font-color")){var a=e.hasOwnProperty("color")?e.color:e["font-color"];n.color=a}else n.color=t.color;if(e.hasOwnProperty("stroke")){var o=e.stroke;n.stroke=o.hasOwnProperty("color")?o.color:t.stroke,n.strokeThickness=o.hasOwnProperty("thinkness")?o.thinkness:t.strokeThickness}else n.stroke=t.stroke,n.strokeThickness=t.strokeThickness}if(e.hasOwnProperty("shadow")){var l=e.shadow;n.shadowColor=l.hasOwnProperty("color")?l.color:t.shadowColor,n.shadowOffsetX=l.hasOwnProperty("offsetX")?l.offsetX:t.shadowOffsetX,n.shadowOffsetY=l.hasOwnProperty("offsetY")?l.offsetY:t.shadowOffsetY,n.shadowBlur=l.hasOwnProperty("blur")?l.blur:t.shadowBlur,n.shadowStroke=!0,n.shadowFill=!0}else n.shadowColor=t.shadowColor,n.shadowOffsetX=t.shadowOffsetX,n.shadowOffsetY=t.shadowOffsetY,n.shadowBlur=t.shadowBlur,n.shadowStroke=t.shadowStroke,n.shadowFill=t.shadowFill;if(e.hasOwnProperty("u")||e.hasOwnProperty("underline")){var h=e.hasOwnProperty("u")?e.u:e.underline;n.underlineColor=h.hasOwnProperty("color")?h.color:t.underlineColor,n.underlineThickness=h.hasOwnProperty("thinkness")?h.thinkness:t.underlineThickness,n.underlineOffset=h.hasOwnProperty("offset")?h.offset:t.underlineOffset}else n.underlineColor=t.underlineColor,n.underlineThickness=t.underlineThickness,n.underlineOffset=t.underlineOffset;return n}},{key:"propToTagText",value:function(t,e){return e.hasOwnProperty("_class")?""===t&&this.isTextTag(e._class)?"":"<class='".concat(e._class,"'>").concat(t,"</class>"):e.hasOwnProperty("_style")?"<style='".concat(e._style,"'>").concat(t,"</style>"):t}},{key:"destroy",value:function(){this.tags=void 0}},{key:"isTextTag",value:function(t){var e=this.tags[t];return!!e&&null==e.img}}]),e}(),_t=function(t){for(var e,n,i,s={},r=0,a=(t=t.split(";")).length;r<a;r++)if(n=(e=t[r].split(":"))[0],i=e[1],!At(n)&&!At(i)){switch(n){case"stroke":var o=i.split(" ");i={},1<=(h=o.length)&&(i.color=o[0]),2<=h&&(i.thinkness=parseInt(o[1].replace("px","")));break;case"shadow":var l=i.split(" ");i={},1<=(h=l.length)&&(i.color=l[0]),2<=h&&(i.offsetX=parseInt(l[1].replace("px",""))),3<=h&&(i.offsetY=parseInt(l[2].replace("px",""))),4<=h&&(i.blur=parseInt(l[3].replace("px","")));break;case"u":case"underline":var h,u=i.split(" ");i={},1<=(h=u.length)&&(i.color=u[0]),2<=h&&(i.thinkness=parseInt(u[1].replace("px",""))),3<=h&&(i.offset=parseInt(u[2].replace("px","")));break;case"y":i=parseFloat(i)}s[n]=i}return s},At=function(t){return 0===(t=t.replace(Yt,"")).length},Bt=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>|<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/g,It=/<\s*class=/i,Ht=/<\s*class=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/class\s*\>/,jt=/<\s*style=/i,Xt=/<\s*style=["|']([^"|']+)["|']\s*\>([\s\S]*?)<\s*\/style\s*\>/,Yt=/^\s+|\s+$/,Gt=Phaser.Utils.Objects.GetValue;return function(){t(h,Ft);var l=e(h);function h(t,e,n,i,s){var r;d(this,h);var a=Gt(s,"tags",void 0),o=new Rt(a);return(r=l.call(this,t,e,n,i,s,"rexTagText",o)).parser=o,r}return s(h,[{key:"addTag",value:function(t,e){return this.parser.addTag(t,e),this.updateText(!0)}},{key:"addTags",value:function(t){for(var e in t)this.parser.addTag(e,t[e]);return this.updateText(!0)}},{key:"preDestroy",value:function(){r(u(h.prototype),"preDestroy",this).call(this),this.parser.destroy(),this.parser=void 0}}]),h}()});
